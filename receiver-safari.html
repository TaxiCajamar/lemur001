<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lemur EchoMe P2P Receiver</title>
  <link rel="stylesheet" href="mobile-style.css" />
  <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
  
  <style>
    /* ğŸ†• ESTILO PARA O BOTÃƒO INVISÃVEL DE TESTE (AZUL CLARO) - MANTIDO IGUAL */
    #tecladoTrigger {
      position: absolute;
      background-color: rgba(0, 150, 255, 0.3); /* Azul claro para ver durante teste */
      border: 2px dashed #0096FF;
      cursor: pointer;
      z-index: 10000; /* Fica acima de tudo */
      border-radius: 50%;
      transition: all 0.3s ease;
    }
    
    #tecladoTrigger:hover {
      background-color: rgba(0, 150, 255, 0.5); /* Azul mais forte no hover */
    }
    
    /* Input oculto para abrir teclado */
    #inputOculto {
      position: absolute;
      left: -9999px;
      opacity: 0;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }
    
    /* Feedback visual quando teclado estÃ¡ ativo */
    .teclado-ativo {
      background-color: rgba(0, 255, 0, 0.3) !important;
      border: 2px solid #00FF00 !important;
    }
  </style>
</head>

<body>

  <div class="box-principal">

    <img src="assets/images/lemurBlu.png" alt="Lemur Logo" class="logo" />
    <img src="assets/images/Bridg.png" alt="ponte" class="ponte" />
    <img id="click" src="assets/images/click.png" alt="Click" />
    
    <div id="mobileLoading" class="mobile-loader">
      <div class="loader-circle"></div>
    </div>

    <!-- ğŸ†• CONTAINER PARA INSTRUCTION BOX (DENTRO do box-principal) -->
    <div id="instructionBox"></div>

    <button id="logo-traduz" class="botao-key">
      <img src="assets/images/key.png" alt="Gerar QR Code" />
    </button>

    <button id="toggleCamera" class="camera-toggle-btn">
      <img src="assets/images/girar-camera.png" alt="Alternar CÃ¢mera" />
    </button>

    <div class="translator-label" id="translator-label">
      Real-time translation.
    </div>

    <!-- ğŸ†• CONTAINER PARA REDES SOCIAIS FIXAS -->
    <div class="social-links-fixed"></div>

    <div class="remoter-Lang">ğŸ³ï¸</div>
    <div class="local-Lang">ğŸ³ï¸</div>
    <div class="local-mic-Lang">ğŸ³ï¸</div>

    <div class="video-wrapper">
      <video id="remoteVideo" autoplay playsinline></video>
      <div class="pip-local-wrapper">
        <video id="localVideo" autoplay muted playsinline></video>
      </div>
    </div>
   
    <div class="info-overlay hidden">
      <h2 id="qr-modal-title">This is your online key</h2>

      <div class="qrcode-container">
        <div id="qrcode"></div>
      </div>

      <p class="qr-modal-description" id="qr-modal-description">
        You can ask to scan, share or print on your business card.
      </p>

      <!-- ğŸ†• CONTAINER PARA BOTÃ•ES DE COMPARTILHAMENTO -->
      <div class="social-buttons"></div>

      <button id="copiarLink" class="btn-copiar-simples">ğŸ”—</button>
    </div>

    <div id="texto-recebido"></div>

    <div class="language-flag" id="currentLanguageFlag">ğŸ‡§ğŸ‡·</div>

    <!-- ğŸ¤ BOTÃƒO MICROFONE ORIGINAL (serÃ¡ coberto pelo botÃ£o invisÃ­vel) -->
    <button class="record-btn" id="recordButton">ğŸ¤</button>

    <!-- ğŸ†• BOTÃƒO INVISÃVEL PARA ATIVAR TECLADO (sobre o microfone) -->
    <button id="tecladoTrigger" title="Abrir teclado nativo"></button>
    
    <!-- ğŸ†• INPUT OCULTO PARA CAPTURAR TEXTO DO TECLADO -->
    <input type="text" id="inputOculto" placeholder="Fale ou digite...">

  </div>

  <div class="recording-modal hidden-until-ready" id="recordingModal">
    <div class="recording-indicator">
      <div class="recording-dot"></div>
      <div class="recording-text">â—</div>
      <div class="recording-timer" id="recordingTimer">0:00</div>
    </div>
    <button class="send-button" id="sendButton">ğŸ“¤</button>
  </div>

  <script>
    window.liberarInterface = function () {
      console.log('âœ… Interface jÃ¡ estÃ¡ visÃ­vel');
    };

    window.mostrarErroCarregamento = function (mensagem) {
      alert('Erro: ' + mensagem);
    };

    document.addEventListener('DOMContentLoaded', function () {
      const overlay = document.querySelector('.info-overlay');
      if (overlay) {
        overlay.classList.add('hidden');
      }
      
      // ğŸ†• POSICIONAR O BOTÃƒO INVISÃVEL SOBRE O MICROFONE - MANTIDO IGUAL
      function posicionarBotaoTeclado() {
        const recordButton = document.getElementById('recordButton');
        const tecladoTrigger = document.getElementById('tecladoTrigger');
        
        if (recordButton && tecladoTrigger) {
          const rect = recordButton.getBoundingClientRect();
          
          // Posicionar exatamente sobre o botÃ£o do microfone
          tecladoTrigger.style.position = 'fixed';
          tecladoTrigger.style.left = rect.left + 'px';
          tecladoTrigger.style.top = rect.top + 'px';
          tecladoTrigger.style.width = rect.width + 'px';
          tecladoTrigger.style.height = rect.height + 'px';
          
          console.log('âœ… BotÃ£o teclado posicionado sobre o microfone');
        }
      }
      
      // Posicionar quando a pÃ¡gina carregar
      posicionarBotaoTeclado();
      
      // Reposicionar se a janela for redimensionada
      window.addEventListener('resize', posicionarBotaoTeclado);
      
      // ğŸ†• CONFIGURAR CLIQUE NO BOTÃƒO INVISÃVEL - MANTIDO IGUAL
      const tecladoTrigger = document.getElementById('tecladoTrigger');
      const inputOculto = document.getElementById('inputOculto');
      
      if (tecladoTrigger && inputOculto) {
        tecladoTrigger.addEventListener('click', function() {
          console.log('ğŸ¹ Abrindo teclado nativo...');
          
          // Dar feedback visual
          tecladoTrigger.classList.add('teclado-ativo');
          
          // Focar no input oculto para abrir teclado
          inputOculto.focus();
          
          // Remover feedback visual apÃ³s 1 segundo
          setTimeout(() => {
            tecladoTrigger.classList.remove('teclado-ativo');
          }, 1000);
        });
        
        // ğŸ†• CAPTURAR TEXTO DIGITADO/FALADO NO TECLADO - AGORA COM startTranslation
        inputOculto.addEventListener('input', function(event) {
          const texto = event.target.value.trim();
          if (texto !== '') {
            console.log('ğŸ“ Texto do teclado nativo:', texto);
            
            // ğŸ¯ CHAMAR A FUNÃ‡ÃƒO EXATA DO SEU SISTEMA - startTranslation
            if (typeof startTranslation === 'function') {
              console.log('âœ… Chamando startTranslation() com texto:', texto);
              startTranslation(texto);
            } else {
              console.log('âŒ startTranslation nÃ£o encontrada');
              // Fallback: mostrar no console para debug
              console.log('ğŸ” Texto que seria enviado:', texto);
            }
            
            // Limpar input para prÃ³xima uso
            setTimeout(() => {
              inputOculto.value = '';
            }, 100);
          }
        });
        
        // ğŸ†• TambÃ©m capturar quando usuÃ¡rio pressiona Enter
        inputOculto.addEventListener('keypress', function(event) {
          if (event.key === 'Enter') {
            const texto = inputOculto.value.trim();
            if (texto !== '') {
              console.log('ğŸ“ Texto do teclado (Enter):', texto);
              
              if (typeof startTranslation === 'function') {
                startTranslation(texto);
              }
              
              inputOculto.value = '';
            }
          }
        });
      }
    });
  </script>

  <!-- ğŸ”¥ IMPORTE OS ARQUIVOS EXTERNOS -->
  <script src="core/redes-sociais.js"></script>
  <script src="core/instruction-box.js"></script>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script type="module" src="./js/receiver/receiver-ui.js"></script>
  <script src="./js/receiver/receiver-trz.js"></script>
  
</body>
</html>
