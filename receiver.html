<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lemur EchoMe P2P Receiver</title>
  
  <link rel="stylesheet" href="mobile-style.css" />
  
  <!-- DEPEND√äNCIAS EXTERNAS -->
  <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
  <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>

  <style>
    /* SEUS ESTILOS ATUAIS (mantidos) */
    .info-overlay.hidden { opacity: 0; pointer-events: none; }
    .social-buttons { display: flex; gap: 8px; justify-content: center; margin: 15px 0; flex-wrap: wrap; }
    .social-btn { width: 35px; height: 35px; border: none; border-radius: 5px; color: white; font-weight: bold; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center; transition: transform 0.2s; }
    .social-btn:hover { transform: scale(1.1); }
    .facebook { background: #3b5998; } .twitter { background: #1da1f2; } .linkedin { background: #0077b5; } .whatsapp { background: #25d366; } .telegram { background: #0088cc; }
    .social-links-fixed { position: absolute; top: 22%; left: 50%; transform: translateX(-50%); display: flex; gap: 8px; justify-content: center; margin: 10px 0; flex-wrap: wrap; width: 80%; z-index: 10; }
    .social-btn-fixed { width: 35px; height: 35px; border: none; border-radius: 5px; color: white; font-weight: bold; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center; transition: transform 0.2s; text-decoration: none; }
    .social-btn-fixed:hover { transform: scale(1.1); }
    .instagram { background: #E4405F; } .website { background: #4CAF50; }
  </style>
</head>

<body>
  <!-- SEU CONTE√öDO HTML ATUAL (mantido igual) -->
  <div class="box-principal">
    <!-- ... todo o conte√∫do atual ... -->
  </div>

  <!-- SCRIPTS NA ORDEM CORRETA -->
  <script>
    // CONFIGURA√á√ÉO GLOBAL
    window.SIGNALING_SERVER_URL = 'https://lemur-signal.onrender.com';
    window.APP_CONFIG = {
      debug: true,
      autoReconnect: true,
      iceServers: [
        { urls: 'stun:stun.l.google.com:19302' },
        { urls: 'stun:stun1.l.google.com:19302' }
      ]
    };

    // FUN√á√ïES GLOBAIS
    window.liberarInterface = function() {
      console.log('‚úÖ Interface liberada');
      document.getElementById('mobileLoading')?.classList.add('hidden');
    };

    window.mostrarErroCarregamento = function(mensagem) {
      console.error('‚ùå Erro de carregamento:', mensagem);
      alert('Erro: ' + mensagem);
    };

    // FUN√á√ÉO COMPARTILHAR SOCIAL (J√Å EXISTENTE)
    function compartilharSocial(rede) {
      if (!window.qrCodeData) {
        console.error('‚ùå QR Code n√£o gerado ainda');
        alert('Gere o QR Code primeiro!');
        return;
      }
      
      const myId = window.qrCodeData?.myId || '';
      const token = window.qrCodeData?.token || '';
      const lang = window.qrCodeData?.lang || 'pt-BR';
      
      const callerUrl = `${window.location.origin}/caller.html?targetId=${myId}&token=${encodeURIComponent(token)}&lang=${encodeURIComponent(lang)}`;
      
      const texto = "Conecte-se comigo via tradu√ß√£o em tempo real!";
      const urlEncoded = encodeURIComponent(callerUrl);
      const textoEncoded = encodeURIComponent(texto);
      
      const urls = {
        facebook: `https://www.facebook.com/sharer/sharer.php?u=${urlEncoded}`,
        twitter: `https://twitter.com/intent/tweet?url=${urlEncoded}&text=${textoEncoded}`,
        linkedin: `https://www.linkedin.com/sharing/share-offsite/?url=${urlEncoded}`,
        whatsapp: `https://api.whatsapp.com/send?text=${textoEncoded}%20${urlEncoded}`,
        telegram: `https://t.me/share/url?url=${urlEncoded}&text=${textoEncoded}`
      };
      
      if (urls[rede]) {
        window.open(urls[rede], '_blank', 'width=600,height=400');
      }
    }

    // üÜï FUN√á√ÉO COPIAR LINK (FALTANTE)
    document.addEventListener('DOMContentLoaded', function() {
      const copiarLinkBtn = document.getElementById('copiarLink');
      if (copiarLinkBtn) {
        copiarLinkBtn.addEventListener('click', function() {
          if (!window.qrCodeData) {
            alert('Gere o QR Code primeiro!');
            return;
          }
          
          const myId = window.qrCodeData?.myId || '';
          const token = window.qrCodeData?.token || '';
          const lang = window.qrCodeData?.lang || 'pt-BR';
          
          const callerUrl = `${window.location.origin}/caller.html?targetId=${myId}&token=${encodeURIComponent(token)}&lang=${encodeURIComponent(lang)}`;
          
          navigator.clipboard.writeText(callerUrl).then(() => {
            alert('Link copiado para a √°rea de transfer√™ncia!');
          }).catch(err => {
            console.error('Erro ao copiar:', err);
            // Fallback para m√©todos antigos
            const textArea = document.createElement('textarea');
            textArea.value = callerUrl;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert('Link copiado!');
          });
        });
      }
    });

    // VERIFICA√á√ÉO DE DEPEND√äNCIAS
    function verificarDependencias() {
      const dependencias = {
        'Socket.IO': typeof io !== 'undefined',
        'QRCode.js': typeof QRCode !== 'undefined'
      };
      
      console.log('üîç Verificando depend√™ncias:', dependencias);
      
      for (const [lib, loaded] of Object.entries(dependencias)) {
        if (!loaded) {
          console.error(`‚ùå ${lib} n√£o carregado`);
          mostrarErroCarregamento(`${lib} falhou ao carregar`);
          return false;
        }
      }
      
      console.log('‚úÖ Todas as depend√™ncias carregadas');
      return true;
    }

    // INICIALIZA√á√ÉO
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üöÄ DOM Carregado - Iniciando verifica√ß√£o...');
      
      if (!verificarDependencias()) {
        return;
      }
      
      const overlay = document.querySelector('.info-overlay');
      if (overlay) {
        overlay.classList.add('hidden');
      }
      
      console.log('‚úÖ Sistema pronto para inicializa√ß√£o dos m√≥dulos');
    });

    // TRATAMENTO DE ERROS GLOBAL
    window.addEventListener('error', function(e) {
      console.error('‚ùå Erro global capturado:', e.error);
    });

    window.addEventListener('unhandledrejection', function(e) {
      console.error('‚ùå Promise rejeitada:', e.reason);
    });
  </script>

  <!-- M√ìDULOS DA APLICA√á√ÉO -->
  <script type="module" src="./js/receiver/receiver-ui.js"></script>
  <script type="module" src="./js/receiver/receiver-trz.js"></script>

</body>
</html>
